!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CameraControls=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function i(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}var a=void 0,o=void 0,s=void 0,n=void 0,r={NONE:-1,ROTATE:0,DOLLY:1,TRUCK:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_TRUCK:5};return function(){function h(e,i){if(t(this,h),this.object=e,this.enabled=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.dampingFactor=.05,this.draggingDampingFactor=.25,this.dollySpeed=1,this.truckSpeed=2,this.domElement=i,this.target=new a.Vector3,this._targetEnd=new a.Vector3,this._spherical=new a.Spherical,this._spherical.setFromVector3(this.object.position),this._sphericalEnd=(new a.Spherical).copy(this._spherical),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._zoom0=this.object.zoom,this._needsUpdate=!0,this.update(),this.domElement){var s=function(t){if(_.enabled){t.preventDefault();var e=b;switch(t.button){case a.MOUSE.LEFT:b=r.ROTATE;break;case a.MOUSE.MIDDLE:b=r.DOLLY;break;case a.MOUSE.RIGHT:b=r.TRUCK}e===r.NONE&&p(t)}},n=function(t){if(_.enabled){t.preventDefault();var e=b;switch(t.touches.length){case 1:b=r.TOUCH_ROTATE;break;case 2:b=r.TOUCH_DOLLY;break;case 3:b=r.TOUCH_TRUCK}e===r.NONE&&p(t)}},c=function(t){_.enabled&&(t.preventDefault(),t.deltaY<0?u():t.deltaY>0&&g())},d=function(t){_.enabled&&t.preventDefault()},p=function(t){if(_.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,a=e.clientY;if(f=_.domElement.getBoundingClientRect(),E.set(i,a),b===r.TOUCH_DOLLY){var o=i-t.touches[1].pageX,s=a-t.touches[1].pageY,n=Math.sqrt(o*o+s*s);v.set(0,n)}y=_.dampingFactor,_.dampingFactor=_.draggingDampingFactor,document.addEventListener("mousemove",m,{passive:!1}),document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("mouseup",l),document.addEventListener("touchend",l)}},m=function(t){if(_.enabled){t.preventDefault();var e=t.touches?t.touches[0]:t,i=e.clientX,s=e.clientY,n=E.x-i,h=E.y-s;switch(E.set(i,s),b){case r.ROTATE:case r.TOUCH_ROTATE:var c=2*Math.PI*n/f.width,d=2*Math.PI*h/f.height;_.rotate(c,d,!0);break;case r.DOLLY:break;case r.TOUCH_DOLLY:var p=i-t.touches[1].pageX,m=s-t.touches[1].pageY,l=Math.sqrt(p*p+m*m),y=v.y-l;y>0?g():y<0&&u(),v.set(0,l);break;case r.TRUCK:case r.TOUCH_TRUCK:if(_.object.isPerspectiveCamera){var A=o.copy(_.object.position).sub(_.target),O=_.object.fov*a.Math.DEG2RAD,M=A.length()*Math.tan(O/2),T=_.truckSpeed*n*M/f.height,x=_.truckSpeed*h*M/f.height;_.truck(T,x,!0);break}if(_.object.isOrthographicCamera){var j=n*(_.object.right-_.object.left)/_.object.zoom/f.width,L=h*(_.object.top-_.object.bottom)/_.object.zoom/f.height;_.truck(j,L,!0);break}}}},l=function t(){_.enabled&&(_.dampingFactor=y,b=r.NONE,document.removeEventListener("mousemove",m),document.removeEventListener("touchmove",m),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t))},u=function(){var t=Math.pow(.95,_.dollySpeed);_.object.isPerspectiveCamera?_.dolly(_._sphericalEnd.radius*t-_._sphericalEnd.radius):_.object.isOrthographicCamera&&(_.object.zoom=Math.max(_.minZoom,Math.min(_.maxZoom,_.object.zoom*t)),_.object.updateProjectionMatrix(),_._needsUpdate=!0)},g=function(){var t=Math.pow(.95,_.dollySpeed);_.object.isPerspectiveCamera?_.dolly(_._sphericalEnd.radius/t-_._sphericalEnd.radius):_.object.isOrthographicCamera&&(_.object.zoom=Math.max(_.minZoom,Math.min(_.maxZoom,_.object.zoom/t)),_.object.updateProjectionMatrix(),_._needsUpdate=!0)},_=this,E=new a.Vector2,v=new a.Vector2,b=r.NONE,f=void 0,y=void 0;this.domElement.addEventListener("mousedown",s),this.domElement.addEventListener("touchstart",n),this.domElement.addEventListener("wheel",c),this.domElement.addEventListener("contextmenu",d),this.dispose=function(){_.domElement.removeEventListener("mousedown",s),_.domElement.removeEventListener("touchstart",n),_.domElement.removeEventListener("wheel",c),_.domElement.removeEventListener("contextmenu",d),document.removeEventListener("mousemove",m),document.removeEventListener("touchmove",m),document.removeEventListener("mouseup",l),document.removeEventListener("touchend",l)}}else this.dispose=function(){}}return h.install=function(t){a=t.THREE,o=new a.Vector3,s=new a.Vector3,n=new a.Vector3},h.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},h.prototype.rotateTo=function(t,e,i){var a=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));this._sphericalEnd.theta=a,this._sphericalEnd.phi=o,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},h.prototype.dolly=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):this.dollyTo(this._sphericalEnd.radius+t,e)},h.prototype.dollyTo=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):(this._sphericalEnd.radius=a.Math.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0)},h.prototype.pan=function(t,e,i){console.log("`pan` has been renamed to `truck`"),this.truck(t,e,i)},h.prototype.truck=function(t,e,i){this.object.updateMatrix(),s.setFromMatrixColumn(this.object.matrix,0),n.setFromMatrixColumn(this.object.matrix,1),s.multiplyScalar(t),n.multiplyScalar(-e);var a=o.copy(s).add(n);this._targetEnd.add(a),i||this.target.copy(this._targetEnd),this._needsUpdate=!0},h.prototype.moveTo=function(t,e,i,a){this._targetEnd.set(t,e,i),a||this.target.copy(this._targetEnd),this._needsUpdate=!0},h.prototype.fitTo=function(t,e){if(this.object.isOrthographicCamera)console.warn("fitTo is not supported for OrthographicCamera");else{var i=this.object,s=(new a.Box3).setFromObject(t),n=s.getSize(o),r=n.x,h=n.y,c=n.z,d=r/h,p=s.getCenter(o),m=i.fov,l=i.aspect;if(this.rotateTo(0,90*a.Math.DEG2RAD,e),this.moveTo(p.x,p.y,p.z,e),!(d<l)){var u=r/l*.5/Math.tan(m*Math.PI/360)+c/2;return void this.dollyTo(u,e)}var g=.5*h/Math.tan(m*Math.PI/360)+c/2;this.dollyTo(g,e)}},h.prototype.reset=function(t){this._targetEnd.copy(this._target0),this._sphericalEnd.setFromVector3(o.subVectors(this._position0,this._target0)),this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta=this._spherical.theta%(2*Math.PI),t||(this.target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},h.prototype.saveState=function(){this._target0.copy(this.target),this._position0.copy(this.object.position),this._zoom0=this.object.zoom},h.prototype.update=function(t){var e=this.dampingFactor*t/.016,i=this._sphericalEnd.theta-this._spherical.theta,o=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,n=(new a.Vector3).subVectors(this._targetEnd,this.target);Math.abs(i)>.001||Math.abs(o)>.001||Math.abs(s)>.001||Math.abs(n.x)>.001||Math.abs(n.y)>.001||Math.abs(n.z)>.001?(this._spherical.set(this._spherical.radius+s*e,this._spherical.phi+o*e,this._spherical.theta+i*e),this.target.add(n.multiplyScalar(e)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this.target.copy(this._targetEnd)),this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this.target),this.object.lookAt(this.target);var r=this._needsUpdate;return this._needsUpdate=!1,r},h.prototype.toJSON=function(){return JSON.stringify({enabled:this.enabled,minDistance:this.minDistance,maxDistance:e(this.maxDistance),minPolarAngle:this.minPolarAngle,maxPolarAngle:e(this.maxPolarAngle),minAzimuthAngle:e(this.minAzimuthAngle),maxAzimuthAngle:e(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,target:this._targetEnd.toArray(),position:this.object.position.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray()})},h.prototype.fromJSON=function(t,e){var o=JSON.parse(t),s=(new a.Vector3).fromArray(o.position);this.enabled=o.enabled,this.minDistance=o.minDistance,this.maxDistance=i(o.maxDistance),this.minPolarAngle=o.minPolarAngle,this.maxPolarAngle=i(o.maxPolarAngle),this.minAzimuthAngle=i(o.minAzimuthAngle),this.maxAzimuthAngle=i(o.maxAzimuthAngle),this.dampingFactor=o.dampingFactor,this.draggingDampingFactor=o.draggingDampingFactor,this.dollySpeed=o.dollySpeed,this.truckSpeed=o.truckSpeed,this._target0.fromArray(o.target0),this._position0.fromArray(o.position0),this._targetEnd.fromArray(o.target),this._sphericalEnd.setFromVector3(s.sub(this._target0)),e||(this.target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},h}()});
